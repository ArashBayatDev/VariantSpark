#!/bin/bash

PWD=$(cd `dirname "$0"`; pwd)

RUNNER=spark
declare -a SPARK_PARAMS 
spark_param_index=0
if [[ "$1" == "--spark"  || "$1" == "--local" ]]; then
	if [[ "$1" == "--local" ]]; then
		RUNNER=local
	fi
	shift 1
	while [[ "$#" -gt 0 ]]; do
		arg="$1"
		shift 1
		if [[ "$arg" == "--" ]]; then
			break
		fi
		SPARK_PARAMS[spark_param_index]="$arg"
		((spark_param_index+=1))
	done
fi

if [[ "${RUNNER}" == "spark" ]]; then
	spark-submit --class au.csiro.variantspark.cli.VariantSparkApp \
 	--driver-class-path ${PWD}/conf \
 	"${SPARK_PARAMS[@]}" \
 	${PWD}/target/variant-spark-0.0.1-SNAPSHOT-all.jar "$@"
else
	SPARK_ASSEMBLY=$(ls ${SPARK_HOME}/lib/spark-assembly-*.jar)
	SPARK_CLASSPATH="${PWD}/conf:${PWD}/target/variant-spark-0.0.1-SNAPSHOT-all.jar:${SPARK_ASSEMBLY}:/usr/lib/hadoop/lib/*:/usr/lib/hadoop/.//*:/usr/lib/hadoop-hdfs/./:/usr/lib/hadoop-hdfs/lib/*:/usr/lib/hadoop-hdfs/.//*:/usr/lib/hadoop-yarn/lib/*:/usr/lib/hadoop-yarn/.//*:/usr/lib/hadoop-mapreduce/lib/*:/usr/lib/hadoop-mapreduce/.//*"
	java -cp "${SPARK_CLASSPATH}"  au.csiro.variantspark.cli.VariantSparkApp "$@"
fi
