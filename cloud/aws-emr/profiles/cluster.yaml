--- 
test: "Data"
options:
  region: {{region}}
  name: "test-spark-m4x2-spot"
  release-label: {{release-label}}
  auto-terminate: {{auto-terminate}}
  applications:
  - Name: Ganglia
  - Name: Spark 
  tags:
    application: "variant-spark"
    use: "testing"
  ec2-attributes: {{ec2-attributes}}
  log-uri: "s3n://{{conf.logBucketBase}}/logs/"
  ebs-root-volume-size: 10 
  service-role: EMR_DefaultRole 
  enable-debugging: true 
  scale-down-behavior: TERMINATE_AT_INSTANCE_HOUR 
  instance-groups: 
  - Name: "Master Instance Group"
    InstanceCount: 1
    InstanceGroupType: "MASTER"
    InstanceType: "m4.large"
    EbsConfiguration:
      EbsBlockDeviceConfigs:
      - VolumeSpecification:
          SizeInGB: 32
          VolumeType: "gp2"
        VolumesPerInstance: 1
  - Name: "Core Instance Group"
    InstanceCount: 1
    InstanceGroupType: "CORE"
    InstanceType: "m4.large"
    EbsConfiguration:
      EbsBlockDeviceConfigs:
      - VolumeSpecification:
          SizeInGB: 32
          VolumeType: "gp2"
        VolumesPerInstance: 1
  - Name: "Task Instance Group"
    InstanceCount: {{taskInstanceGroup.InstanceCount}}
    InstanceGroupType: "TASK"
    InstanceType: {{taskInstanceGroup.InstanceType}}
    BidPrice: "{{taskInstanceGroup.BidPrice}}"
    EbsConfiguration:
      EbsBlockDeviceConfigs:
      - VolumeSpecification:
          SizeInGB: 32
          VolumeType: "gp2"
        VolumesPerInstance: 1
  configurations:
  - Classification: "spark"
    Properties:
      maximizeResourceAllocation: "true" 
  - Classification: "spark-defaults"
    Properties:
      spark.eventLog.dir: "s3://{{conf.logBucketBase}}/sparklog/"
      spark.history.fs.logDirectory: "s3://{{conf.logBucketBase}}/sparklog/"
      spark.dynamicAllocation.enabled: "false"
      spark.executor.instances: "{{taskInstanceGroup.InstanceCount}}"
  bootstrap-actions:
  - Path: "s3://au.csiro.pbdava.test/variant-spark/bootstrap/install-variant-spark.sh"
    Name: "Install Variant Spark" 